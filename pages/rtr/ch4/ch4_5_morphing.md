---
title: "变形"
sidebar: rtr
layout: book
permalink: rtr_ch4_morphing.html
summary: 第四章.
---

### 4.5 变形
从一个三维模型，变形到另一个三维模型，在表现动画中非常的有用。设想在t0时刻我们显示了一个模型，到t1时刻希望把它变成另一个模型。在t0和t1之间，需要使用一些插值方法来生成一个持续混合的模型。4.13展示了一个变形的例子。

![图](/images/RTR3.04.13.png)
图4.13

变形主要解决两个问题，被称作`顶点一致问题(vertex correspondence)`和`插值问题`。给定任意两个模型，它们可能有不同的拓扑结构，不同的顶点数量，不同的网格结构，这可能就是顶点一致问题的初始输入数据。这是很困难的问题，这个领域也已经有了很多研究。感兴趣的读者可以查阅Alexa的文献。

但是假如两个模型之间的顶点有着一对一的关系，那么插值就可以依次在每个顶点上完成。就是说，第一个模型的顶点，在第二个模型上有且仅有一个顶点和它对应，反之亦然。这种插值就比较简单。比如，可以直接在顶点上做线性插值（13.1介绍了其他的插值方式）。计算$t \in [t_0, t_1]$时刻顶点的变形，我们先计算$s = (t - t_0)/(t_1 - t_0)$，然后使用线性插值：其中$p_0,p_1$为两个模型上对应的两个点，也就是$t_0$时刻的点和$t_1$时刻的点。

$$
m = (1 - s)p_0 + sp_1.      \tag{4.57}
$$

一个好玩的变体被称为`目标变形(morph targets)`或`形状混合(blend shapes)`，用户可以更主观的控制。基本思想见图4.14.

![图](/images/RTR3.04.14.png)
图4.14

我们从一个中间模型开始，就是一个脸模型。我们用N来表示模型。此外，我们会有一些不同脸部表情。在这个例子当中，我们只有一个笑脸表情。通常，我们可以使用$k \gt 1$个不同的表情，标记为$P_i, i \in [1,...,k]$。我们会计算$D_i = P_i - N$，来预处理表情之间的不同，也就是各个表情减去中间模型。

现在，我们有一个中间模型N，一些不同的表情$D_i$，一个变形后的模型M，我们可以用下面的公式来表示：

$$
\mathcal{M} = \mathcal{N} + \sum_{i=1}^{k} w_iD_i.   \tag{4.58}
$$

我们用中间模型加上不同表情定义的特点，使用权重$w_i$来得到想要的效果。在图4.14中，使用$w_i$得到的结果就是完全是微笑模型定义的内容。使用$w_i = 0.5$，则会得到一个半微笑的模型等等。你甚至可以使用负的权重，或者超过1的权重。

对于这个简单的脸模型，我们可以再添加一个`悲伤`的眉毛。使用一个负的权重可以得到一个`高兴`的眉毛。因为替换都是相加的，所以这个眉毛可以和微笑的表情组合使用。`Morph targets`是项非常有用的技术，它可以对动画对象提供非常大的控制能力，因为模型的不同特性可以独立的操作。Lewis等人在他们的文章中介绍了`表情姿势变形(pose-space deformation)`，结合使用了顶点融合和目标变形。支持DX10的硬件，可以使用流输出以及其他功能，来在单个模型上使用更多特征点，特效的计算只在GPU上进行。

图4.15展示了一个皮肤和变形的真实例子。

![图](/images/RTR3.04.15.png)
图4.15



