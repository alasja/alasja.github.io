---
title: "3.4 顶点着色器"
keywords: sample homepage
tags: [getting_started]
sidebar: rtr
layout: book
permalink: rtr_ch3_vertex.html
summary: 顶点着色器
---

### 3.4 顶点着色器
顶点着色器是图3.2中的第一个功能流水线。这是图形处理的第一个阶段，值得注意的是有些数据在这个阶段之前就被处理过了。在DX中这叫输入汇编器，很多数据流交织在一起组成了顶点和图元的数据，被一起传递给流水线。举个例子，一个对象可以用一组位置加一组颜色来表现。输入汇编器会构建这个对象的三角形的每个顶点，使用位置和颜色数据。另一个对象可以使用同一组位置数据（但是使用不同的模型转换矩阵）和一组不同的颜色来表现。12.4.5会介绍数据表现的细节。输入汇编器也支持实例化(instancing)，这可以让对象使用一些不同数据来绘制多次，但只用一次<font color="limegreen">DC</font>。15.4.2会介绍实例化的应用。DX10的这种输入汇编器会给每个实例、图元和顶点打上唯一数字标签，然后在接下来的所有着色阶段都可以访问到这些标签。早期着色模型中，这种标签数据则需要显示的添加才行。

要表现一个三角面网格，需要一堆顶点，还得知道哪些顶点属于哪些三角形。顶点着色器是处理这个网格的第一步。顶点着色器对三角形怎么组成一无所知，它只关注它正操作的那个顶点。一般来说，顶点着色器能够对顶点的颜色、法线、纹理坐标以及位置进行修改、新建等操作。通常，顶点着色器会把顶点的坐标位置从模型空间转换到<font color="limegreen">齐次裁剪空间</font>，实际上，这是顶点着色最起码要做的。

这个功能首次在2001发布的DX8中描述。因为它是流水线的第一个阶段，而且调用次数相对比较少（相对像素着色器来说那确实比较少），所以可以随便选择在CPU或者GPU上实现，只要把结果传递给GPU做栅格化就好了。这么做主要会影响新旧硬件的过渡速度，无关功能。毕竟现在所有的GPU都支持顶点着色了。

一个顶点着色器本身就跟我们在3.2中描述的虚拟机很像。每个顶点都被处理一遍，然后输出一些数值，再根据三角形或线条才插值。顶点着色器既不能创建也不能删除顶点，一个顶点的输出结果也不能用到别的顶点上。因为各个顶点都是独立处理的，所以GPU能对顶点流进行任意数量的并行处理。

接下的部分介绍一些顶点着色器特效，比方阴影构建，动画的顶点混合，轮廓绘制等。其他还包括：

* 镜头效果，类似鱼眼、水底、以及其他扭曲效果。
* 自定义对象，仅创建一次纹理，然后使用着色器来使它变形。
* 对象扭曲、融合、虚化等操作。
* 图元构建，只给下一个流水线传递需要的部分，从而变成新的图元，这部分功能在新的GPU中已可在几何着色器中完成。
* 翻页、热浪、水波，以及其他需要把整个帧缓冲数据当纹理数据来使用，在整个屏幕范围内不断计算变形的特效。
* 顶点纹理获取（着色模型3.0以上）可以设置顶点的纹理，这让海洋和地形高度区域的设置不会那么耗。

图3.5展示了一些顶点着色器表现的变形。

![图](/images/RTR3.03.05.png)

顶点着色器的输出有多种使用途径。通常都是提供给构建三角形和栅格化使用，以及像素着色器做进一步的处理。在着色模型4.0中，几何着色器也会使用这些数据，或者流输出。这部分是下一节的内容了。
