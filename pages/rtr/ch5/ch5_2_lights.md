---
title: "5.2 光源"
sidebar: rtr
layout: book
permalink: rtr_ch5_lights.html
---

### 5.2 光源
光有很多不同的定义，如几个射线，电磁波或者光粒子（有波动属性的光粒子）。不管如何定义它，光线是一种电磁辐射能量，空间中的电磁能量。光源发射光线，而不吸收或反射光线。

光源可以通过很多不同方法来表现。这里我们先讨论一种简单的光照模型——更复杂高级的光照模型会在第7.4节和第8章讨论。像太阳这种特定距离的光源非常容易模拟；他们的发出的光照在整个空间中都是统一个角度。所以他们被称为`方向光(directional lights)`。在渲染中，这种方向性的光源被描述成光向量$l$，使用世界空间坐标。本书提到的向量**l**的长度总是1 。对于方向光， **l**总是已经被程序规范化好的，以避免着色器过程中再次规范化。光向量**l**定义的方向跟光线传递的方向是`相反的`(见图5.2)。我们一会解释这一点，非常的简单。

![图](/images/RTR3.05.02.png)
图5.2

除了光照方向，光照强度也需要确定下来。光照度量科学，`辐射度测量`会在章节7.1中讨论；本章只会提及一些概念。方向光的强度，可以通过测量垂直于**l**的单位面积的表面，接受到的光照来量化。见图5.3。这被称为`辐照度(irradiance)`，等价于一秒内穿过表面的光量子能量总和。光是有颜色的，所以我们会用一个rgb向量来表现辐照度，它包含三个数值：分别是红、绿、蓝（7.3节会讨论颜色更严格的定义）。注意跟绘图程序中不一样的是，rgb辐照度值可以超过1，理论上来说肯定会大于1。

![图](/images/RTR3.05.03.png)
图5.3

即便只有一个主光源，光线会在其他物体上传递，房间的墙壁也会照亮物体。这种整个周围环境的光想被称为`环境光(ambient light)`。在第八第九章我们会看到不同的环境光模型，不过为了简单起见，本章不会讨论他们。在我们的简单光照模型中，物体如果没有被光照直接照射到的话，就会是黑色的。

尽管测量垂直**l**的平面的辐照度告诉我们光照有多么强，要计算它在一个表面上的光照，我们需要测量平行于那个表面的平面上的辐照度（也就是垂直于表面的法线**n**）。表面的辐照度，等于垂直于**l**面上的辐照度乘以**l**和**n**夹角$\theta_i$的cosine值（见图5.4的左边）。

![图](/images/RTR3.05.04.png)
图5.4

图5.4的中间和右边的光照图展示了这个余弦因子的一个几何解释。中间那个图中，光线垂直照射在表面上。辐照度跟光线的密度成正比，跟光线之间的距离成反比。这个例子中，表面的辐照度等于垂直于**l**的表面的辐照度。在右图中，光线的角度发生了变化。它们跟平面的法线成角度$\theta_i$。光线到达表面的距离就变成了$d/cos(\theta_i)$。因为辐照度反比于这个距离，所以它必然正比于$cos(\theta_i)$。这个余弦值很容易计算，在着色器中使用对两个向量使用点积即可（注意**l**和**n**的长度都假定为1才行）。现在我们知道为什么**l**定义为光线传递的相反方向，否则我们在计算点积之前总是得把它反过来。

我们使用**E**来表示辐照度，通常是垂直**n**的辐照度。我们使用$E_L$表示垂直**l**的辐照度。注意余弦为负值的时候表示光线是从平面的反面照射过来的。这种情况下光线不应该照射到表面，所以我们把余弦值修正到非负范围（用$\overline{cos}$表示）：

$$
\begin{align}
E &= E_L \overline{cos}\theta_i \\
&= E_L max(n \cdot l, 0).  \tag{5.1}
\end{align}
$$

图5.3和图5.4中，所有的光线都是保持着固定的方向。不过，辐照度可以测量任意的光线方向。辐照度的定义还是一样：光线一秒内穿过单位区域平面的能量（见图5.5）。现实中有个相关的测量设备：光表。这个仪器测量一些波段的辐照度，乘以光可见的倾斜度，然后得到特定方向上到达一个小区域的光量。

![图](/images/RTR3.05.05.png)
图5.5

注意辐照度是叠加的，总辐照度等于不同方向的光源辐照度的总和：

$$
E = \sum_{k=1}^n E_{L_k} \overline{cos} \theta_{i_k}.   \tag{5.2}
$$

其中$E_{L_k},\theta_{i_k}$分别表示第k个光源的$E_L和\theta_i$。


